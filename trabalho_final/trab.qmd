---
title: "Classificação de Sítio e Análise Econômica das Fazendas"
author: Gabriel de Freitas Pereira
lang: pt
execute:
  echo: false
format:
  pdf:
    toc: true
    number-sections: true
bibliography: references.bib
header-includes: 
   \usepackage{graphicx}
   \usepackage{fancyhdr}
   \pagestyle{fancy}
   \setlength\headheight{28pt}
   \fancyhead[L]{\includegraphics[width=5cm]{chestreelogo.png}}
   \fancyfoot[LE,RO]{chesTree}
editor_options: 
  markdown: 
    wrap: 72
---

![](chestreelogo.png)

*Be the change you want to see in the world*

\newpage

## Apresentação

  A chesTree é uma empresa de consultoria e serviços florestais,
especializada nos processos que envolvem medições e realizações de
inventários. A chesTree conta com profissionais qualificados e renomados
do mercado, atuando na área florestal desde 1990. A sede da empresa está
localizada em São Paulo, mas conta com filiais espalhadas por todo país.

## Introdução

  Um inventário florestal é uma prática que busca a quantificação, e por
conseguinte, a qualificação das florestas em diferentes aspectos, como a
produção de madeira e outros possíveis produtos, através do uso de
técnicas estatísticas de amostragem. Considerando que, o inventário visa
obter o máximo de informações de uma floresta com a máxima precisão e o
mínimo custo. Esses três fatores desempenham papel importante no
planejamento de um inventário florestal [@junior2020measure].

  Sendo assim, o conhecimento dos processos de crescimento e produção de
um povoamento florestal são indubitavelmente necessários ao
gerenciamento racional das florestas plantadas
[@cosenza2015classificaccao]. Logo, as técnicas estatísticas que
envolvem modelagens tornam-se ferramentas importantes para se obter
informações relevantes que auxiliem na tomada de decisões durante o
planejamento florestal, a partir de características encontradas na área
e sua conseguinte prognose de produção gerada. Afinal, o crescimento e a
produção de um povoamento florestal dependem de diversos fatores que
podem ser quantificados e planejados, como a idade, o sítio (potencial
produtivo), os tratos silviculturais, entre outros.

  Dessa forma, com a intenção de prever o crescimento, são estimadas
variáveis dendrométricas e classes de produtividade ou sítio. Portanto,
a determinação de sítio é de suma importância durante todo o sistema de
prognose e definição das classes de produtividade [@demetodos]. Isso se
deve ao fato de que há uma amplitude de variação dos fatores biológicos,
os quais refletem no crescimento das florestas.

  Desse modo, é possível concluir que através das estimativas citadas
anteriormente se pode alcançar a máxima eficiência volumétrica, ou seja,
a idade em que o povoamento atinge ao maximizar o incremento médio anual
(IMA), pois o mesmo apresenta um único ponto de máximo quando associado
a curvas de crescimento que apresentam uma fase inicial com ganhos mais
do que proporcionais, seguida de uma fase com ganhos decrescentes
[@rodriguez2010tecnicas]. Logo, saber quando ocorrerá o máximo lucro por
unidade de área é um fator imprescindível para uma empresa florestal, o
qual é perceptível através desse parâmetro.

## Objetivo

  O presente relatório tem como objetivo utilizar dados de um inventario
florestal contínuo de plantios clonais de *Eucalyptus* sp. no estado de
São Paulo para: classificar os sítios das três fazendas; recomendar a
idade ótima de corte; definir qual a fazenda mais lucrativa dentro das
condições existentes para possível implantação de floresta.

## Metodologia

 

### Classificação de sítios

 

Chapman-Richards

-   anamórfico:
    $Hd_2 = H d_1 * \left[\frac{ ( 1 - e ^ {\beta_1Id_1} ) ^ { \beta_2} } { ( 1 - e ^ {\beta_2Id_2} ) } \right]$

-   polimórfico:
    $Hd2 = \beta_0 * \left( \frac{ Hd_1 } {\beta_0} \right) ^{\frac{ log( 1 - e ^ {\beta*1Id_2 } ) } {log( 1 - e ^ {*\beta 1Id_1} ) } }$

Schumacher

-   anamórfico:
    $Hd_2 = Hd_1 * e^{\beta_1 \left( \frac{ 1 } { Id_2} - \frac{ 1 } { Id_1 } \right)}$

-   polimórfico:
    $Hd_2 = \beta_0 \left( \frac{ Hd_1 } { \beta_0 }\right)^{ \frac{ Id_1 } { Id_2 } }$

Bayley-Clutter

-   anamórfico:
    $Hd_ 2 = \frac{ Hd_1 } { e^{ \beta_1^{ ( Id_ 2 ^{\beta_2} - Id_1 ^{ \beta_2}) } } }$

-   polimórfico:
    $Hd_2 = \beta_0 \left( \frac{ Hd_1 } { \beta_0 } \right )^{ \left( \frac{ Id_1 } { Id_2 } \right ) ^{ \beta_2 } }$


### Prognose e idade técnica de corte

### Análise econômica

 

### Análise de sensibilidade

 

## Resultados e discussão

```{r}
# gráfico de sítios
# Avaliação de estabilidade dos modelos Bailey & Clutter Polimórfico e Chapman & Richards Polimórfico.

### Ajustes dos modelos de classificação de sítios e análise estatistica dos ajustes
library( cmrinvflor )
library( ggplot2 )
library( magick )
library( cowplot )
library( gridExtra )
library( qqplotr )

dados_npar <- read.csv2( "trabalho_final/ifc.csv" )
names( dados_npar )
dados_npar <- dados_npar[ c( "parcela", "idade", "hdom", "ab", "vtsc", "vtcc" ) ]

dados <- cmrinvflor::parear_seqmed( dados_npar )
head( dados )

img <- image_read( "trabalho_final/chestreelogo.PNG" )

theme_chesTree <- theme_bw( ) +
  theme( panel.grid.major = element_line( color = "gray70", linetype = "dashed" ),
         panel.grid.minor = element_blank( ),
         axis.title = element_text( size = rel( 1.25 ) ),
         axis.text = element_text( size = rel( 1.1 ) ),
         legend.position = c( 0, 1 ),
         legend.justification = c( -0.05, 1.02 ),
         legend.title = element_blank( ),
         legend.text = element_text( size = rel( 0.8 ) ) )

p <- ggplot( dados, aes( x = idade2, y = hdom2, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5) +
  #labs( title = "Testando título" ) +
  #geom_hline( yintercept = 0, linetype = "dashed" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( name = "Altura Dominante (cm)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

ggdraw( ) +
  draw_plot( p, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.65, y = 0.02, width = 0.35, height = 0.2 )  

# A curva no gráfico acima é conhecida como LOESS 
# (suavização de dispersão estimada localmente),
# e ela nos mostra o melhor ajuste sem assumir
# que os dados devem se ajustar a alguma forma de distribuição.
# Além disso, foi apresentado o erro padrão em torno da curva em cinza.

# par( mfrow = c( 1, 1 ) )
# with( dados, plot( hdom1, hdom2, pch = 20 ) )

# Ajustes Bayley Clutter --------------------------------------------------

# Ajuste Bayley Clutter polimórfico

bc_poli <- "hdom2~b0*((hdom1/b0)^((idade1/idade2)^b2))"

ajbcpoli <- nls(
  formula = bc_poli,
  data = dados,
  start = list(
    b0 = 50, 
    b2 = 0.5
  )
)

#Erro padrão residual
syxbcpoli <- summary( ajbcpoli )$sigma
syxperbcpoli <- syxbcpoli / mean( dados$hdom2 ) * 100

#coeficientes bc poli
cfbcpoli <- coef( ajbcpoli )

#Ajuste Bayley Clutter anamórfico

bc_ana <- "hdom2~hdom1/(exp(b1*((idade2^b2)-(idade1^b2))))"

ajbcana <- nls(
  formula = bc_ana,
  data = dados,
  start = list(
    b1 = 7.9378414, 
    b2 = -0.4497666
  )
)

#Erro padrão residual
syxbcana <- summary( ajbcana )$sigma
syxperbcana <- syxbcana / mean( dados$hdom2 ) * 100

#coeficientes bc poli
cfbcana <- coef( ajbcana )

# Ajustes Chapman e Richards --------------------------------------------------

# Ajuste Chapman e Richards polimórfico

cr_poli <- "hdom2~b0*((hdom1/b0)^((log(1-exp(b1*idade2)))/(log(1-exp(b1*idade1)))))"

ajcrpoli <- nls(
  formula = cr_poli,
  data = dados,
  start = list(
    b0 = 35.2288428, 
    b1 = -0.0221952
  )
)

#Erro padrão residual
syxcrpoli <- summary( ajcrpoli )$sigma
syxpercrpoli <- syxcrpoli / mean( dados$hdom2 ) * 100

#coeficientes cr poli
cfcrpoli <- coef( ajcrpoli )

#Ajuste Chapman e Richards anamórfico

cr_ana <- "hdom2~((hdom1*(1-exp(b1*(idade2))))/(1-exp(b1*(idade1))))^b2"

ajcrana <- nls(
  formula = cr_ana,
  data = dados,
  start = list(
    b1 = -0.01949213, 
    b2 = 1.05428713
  )
)

#Erro padrão residual
syxcrana <- summary( ajcrana )$sigma
syxpercrana <- syxcrana / mean( dados$hdom2 ) * 100

#coeficientes cr poli
cfcrana <- coef( ajcrana )

# Ajustes Schumacher --------------------------------------------------

# Ajuste Schumacher polimórfico

sch_poli <- "hdom2~b0*((hdom1/b0)^((idade1)/(idade2)))"

ajschpoli <- nls(
  formula = sch_poli,
  data = dados,
  start = list(
    b0 = 39.1903
  )
)

#Erro padrão residual
syxschpoli <- summary( ajschpoli )$sigma
syxperschpoli <- syxschpoli / mean( dados$hdom2 ) * 100

#coeficientes sch poli
cfschpoli <- coef( ajschpoli )

#Ajuste Schumacher anamórfico

sch_ana <- "hdom2~hdom1*(exp(b1*((1/idade2)-(1/idade1))))"

ajschana <- nls(
  formula = sch_ana,
  data = dados,
  start = list(
    b1 = 25.59895
  )
)

#Erro padrão residual
syxschana <- summary( ajschana )$sigma
syxperschana <- syxschana / mean( dados$hdom2 ) * 100

#coeficientes sch ana
cfschana <- coef( ajschana )


# Gráficos ----------------------------------------------------------------

#Calculando os resíduos

#Bayley clutter
dados$resbcpoli <- residuals( ajbcpoli ) #polimórfico
dados$resbcana <- residuals( ajbcana ) #anamórfico

#Chapman e Richards
dados$rescrpoli <- residuals( ajcrpoli ) #polimórfico
dados$rescrana <- residuals( ajcrana ) #anamórfico

#Schumacher
dados$resschpoli <- residuals( ajschpoli ) #polimórfico
dados$resschana <- residuals( ajschana ) #anamórfico

#gráficos com casca

theme_chesTree <- theme_bw( ) +
  theme( panel.grid.major = element_line( color = "gray70", linetype = "dashed" ),
         panel.grid.minor = element_blank( ),
         axis.title = element_text( size = rel( 1.25 ) ),
         axis.text = element_text( size = rel( 0.6 ) ),
         legend.position = c( 0, 1 ),
         legend.justification = c( -0.05, 1.02 ),
         legend.title = element_blank( ),
         legend.text = element_text( size = rel( 1.1 ) ) )

bcnorm_poli <- ggplot( data = dados, mapping = aes( sample = resbcpoli ) ) +
  geom_qq_band( bandType = "ks", mapping = aes( fill = "KS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "ts", mapping = aes( fill = "TS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Pointwise" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Bayley-Clutter Polimórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" ) +
  theme_chesTree

bcnorm_ana <- ggplot( data = dados, mapping = aes( sample = resbcana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Bayley-Clutter Anamórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" )

crnorm_poli <- ggplot( data = dados, mapping = aes( sample = rescrpoli ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Chapman-Richards Polimórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" )

crnorm_ana <- ggplot( data = dados, mapping = aes( sample = rescrana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Chapman-Richards Anamórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" )

scnorm_poli <- ggplot( data = dados, mapping = aes( sample = resschpoli ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Shcumacher Polimórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" )

scnorm_ana <- ggplot( data = dados, mapping = aes( sample = resschana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( ) +
  labs( title = "Schumacher Anamórfico",
        x = "Quantis Normais", 
        y = "Quantis de Amostra" ) +
  scale_fill_discrete( "Faixas de Confiança" )

# "pointwise" constrói bandas de confiança simultâneas com base na distribuição normal;
# "boot" cria bandas de confiança pontuais com base em um boostrap paramétrico;
# "ks" constrói bandas de confiança simultâneas com base em uma inversão do teste de Kolmogorov-Smirnov;
# "ts" constrói bandas de confiança sensíveis à cauda, como proposto por Aldor-Noiman et al. (2013).

arranged_norm <- grid.arrange( bcnorm_ana, 
                               crnorm_poli, crnorm_ana,
                               scnorm_poli, scnorm_ana,
                               ncol = 2, nrow = 3 )

# anexos
ggdraw( ) +
  draw_plot( arranged_norm, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.55, y = 0.02, width = 0.35, height = 0.5 )  


### Resíduos

res_plot_bcpoli <- ggplot( dados, aes( x = idade1, y = resbcpoli, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Bayley-Clutter Polimórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

# anexos
res_plot_bcana <- ggplot( dados, aes( x = idade1, y = resbcana, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Bayley-Clutter Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_crpoli <- ggplot( dados, aes( x = idade1, y = rescrpoli, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Chapman-Richards Polimórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

arranged_res_norm <- grid.arrange( crnorm_poli, res_plot_crpoli, ncol = 2 )

ggdraw( ) +
  draw_plot( arranged_res_norm, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.35, y = 0.02, width = 0.35, height = 0.2 )  


res_plot_crana <- ggplot( dados, aes( x = idade1, y = rescrana, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Chapman-Richards Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_schpoli <- ggplot( dados, aes( x = idade1, y = resschpoli, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Schumacher Polimórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_schana <- ggplot( dados, aes( x = idade1, y = resschana, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "Schumacher Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8:8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

arranged_res <- grid.arrange( res_plot_bcpoli, res_plot_bcana, 
                              res_plot_crana,
                              res_plot_schpoli, res_plot_schana,
                              ncol = 2, nrow = 3 )
# anexos
ggdraw( ) +
  draw_plot( arranged_res, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.58, y = 0.02, width = 0.35, height = 0.5 )  

margin <- theme( plot.margin = unit( c( 2, 2, 2, 2 ), "cm" ) )
grid.arrange( grobs = lapply( pl, "+", margin ) )
```

### Estatísticas dos modelos

### Prognose e idade ótima de corte

### Análise econômica

### Sensibilidade econômica

## Conclusão

## Referências

```{r}

```

```{r}

```
