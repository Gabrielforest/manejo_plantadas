---
title: \large Classificação de Sítio e Análise Econômica das Fazendas Montreal, Santa bárbara e Júlio de Mesquita
author: Gabriel de Freitas Pereira
lang: pt
execute:
  echo: false
format:
  pdf:
    toc: true
    number-sections: true
bibliography: references.bib
header-includes: 
   \usepackage{graphicx}
   \usepackage{fancyhdr}
   \pagestyle{fancy}
   \setlength\headheight{28pt}
   \fancyhead[L]{\includegraphics[width=5cm]{chestreelogo.png}}
   \fancyfoot[LE,RO]{chesTree}
editor_options: 
  markdown: 
    wrap: 72
---

![](chestreelogo.png)

*Be the change you want to see in the world*

\newpage

# Apresentação

  A chesTree é uma empresa de consultoria e serviços florestais, especializada nos processos que envolvem medições e realizações de inventários. A chesTree conta com profissionais qualificados e renomados do mercado, atuando na área florestal desde 1990. A sede da empresa está localizada em São Paulo, mas conta com filiais espalhadas por todo país.

# Introdução

  Um inventário florestal é uma prática que busca a quantificação, e por conseguinte, a qualificação das florestas em diferentes aspectos, como a produção de madeira e outros possíveis produtos, através do uso de técnicas estatísticas de amostragem. Considerando que, o inventário visa obter o máximo de informações de uma floresta com a máxima precisão e o mínimo custo. Esses três fatores desempenham papel importante no planejamento de um inventário florestal [@junior2020measure].

  Sendo assim, o conhecimento dos processos de crescimento e produção de um povoamento florestal são indubitavelmente necessários ao gerenciamento racional das florestas plantadas [@cosenza2015classificaccao]. Logo, as técnicas estatísticas que envolvem modelagens tornam-se ferramentas importantes para se obter informações relevantes que auxiliem na tomada de decisões durante o planejamento florestal, a partir de características encontradas na área e sua conseguinte prognose de produção gerada. Afinal, o crescimento e a produção de um povoamento florestal dependem de diversos fatores que podem ser quantificados e planejados, como a idade, o sítio (potencial produtivo), os tratos silviculturais, entre outros.

  Dessa forma, com a intenção de prever o crescimento, são estimadas variáveis dendrométricas e classes de produtividade ou sítio. Portanto, a determinação de sítio é de suma importância durante todo o sistema de prognose e definição das classes de produtividade [@demetodos]. Isso se deve ao fato de que há uma amplitude de variação dos fatores biológicos, os quais refletem no crescimento das florestas.

  Desse modo, é possível concluir que através das estimativas citadas anteriormente se pode alcançar a máxima eficiência volumétrica, ou seja, a idade em que o povoamento atinge ao maximizar o incremento médio anual (IMA), pois o mesmo apresenta um único ponto de máximo quando associado a curvas de crescimento que apresentam uma fase inicial com ganhos mais do que proporcionais, seguida de uma fase com ganhos decrescentes [@rodriguez2010tecnicas]. Logo, saber quando ocorrerá o máximo lucro por unidade de área é um fator imprescindível para uma empresa florestal, o qual é perceptível através desse parâmetro.

# Objetivo

  O presente relatório tem como objetivo utilizar dados de um inventario florestal contínuo de plantios clonais de *Eucalyptus* sp. no estado de São Paulo, nas fazendas presentes nos municípios de Buri, Itaberá e Itaí para:

-   classificar os sítios das três fazendas;

-   recomendar a idade ótima de corte;

-   definir qual a fazenda mais lucrativa dentro das condições existentes para possível implantação da floresta.

# Metodologia

## Coleta de dados e classificação de sítios

  Inicialmente, os primeiros aspectos da área foram fornecidos pelo proprietário da área e foram analisadas presencialmente na fazenda, e essas informações eram sobre o espaçamento, tipo de solo, relevo, presença de patógenos, umidade do solo, entre outras informações gerais. Depois desse processo, os dados de diâmetro à altura do peito (DAP) foram coletados a 1,3 m do solo, através do uso de uma fita métrica no sentido horizontal em relação ao solo. Quando as árvores estavam em terreno inclinado, a medição foi realizada no ponto mais elevado e no caso das árvores inclinadas a fita métrica foi colocada no sentido perpendicular ao eixo do tronco da árvore. A altura total foi medida através de um hipsômetro Suunto. As informações adquiridas foram armazenadas em tablets, assim como o registro de informações como a localização e identificação da área e locais de acesso.

  Com isso, o procedimento de amostragem que foi adotado na realização do inventário após a análise dos dados foi a amostragem casual simples com parcelas circulares. Esse tipo de amostragem é um método utilizado em populações homogêneas e foi escolhido, justamente, por conta dessa característica do povoamento. Além disso, o procedimento de inventário florestal citado anteriormente foi repetido ao longo dos anos, de forma contínua, com o objetivo de processar os dados nos softwares R 4.2.1 e Microsoft Excel.

  Sendo assim, para a classificação de sítios, foram avaliados os modelos hipsométricos apresentados a seguir, tanto na forma anamórfica quanto polimórfica.

\

Chapman-Richards

-   anamórfico: $Hd_2 = H d_1 * \left[\frac{ ( 1 - e ^ {\beta_1Id_1} ) ^ { \beta_2} } { ( 1 - e ^ {\beta_2Id_2} ) } \right]$

-   polimórfico: $Hd2 = \beta_0 * \left( \frac{ Hd_1 } {\beta_0} \right) ^{\frac{ log( 1 - e ^ {\beta*1Id_2 } ) } {log( 1 - e ^ {*\beta 1Id_1} ) } }$

Schumacher

-   anamórfico: $Hd_2 = Hd_1 * e^{\beta_1 \left( \frac{ 1 } { Id_2} - \frac{ 1 } { Id_1 } \right)}$

-   polimórfico: $Hd_2 = \beta_0 \left( \frac{ Hd_1 } { \beta_0 }\right)^{ \frac{ Id_1 } { Id_2 } }$

Bailey-Clutter

-   anamórfico: $Hd_ 2 = \frac{ Hd_1 } { e^{ \beta_1^{ ( Id_ 2 ^{\beta_2} - Id_1 ^{ \beta_2}) } } }$

-   polimórfico: $Hd_2 = \beta_0 \left( \frac{ Hd_1 } { \beta_0 } \right )^{ \left( \frac{ Id_1 } { Id_2 } \right ) ^{ \beta_2 } }$

  A partir da avaliação feita com base na análise gráfica e atributos estatísticos gerados, foi escolhido o melhor modelo para prosseguir com a classificação de sítio. Dessa forma, a idade referência utilizada para classificar as parcelas medidas foi a de 72 meses, com sítios divididos em quatro classes.

  Além disso, visando garantir a melhor escolha possível do modelo foram comparadas as estabilidades entre parcelas dos dois melhores modelos, escolhendo o modelo mais estável. E com isso, finalmente foi realizada a reclassificação analisando como a altura varia de acordo com a idade da floresta.

 Desse modo, depois da reclassificação foram escolhidos três talhões (1 sítio representando cada talhão), os quais apresentavam relação com a distância, ou seja, quanto melhor o sítio mais distante o talhão.

## Prognose e rotação técnica de corte

  Para estimar a produção do volume, foi realizada a prognose e rotação nas diferentes idades (24, 36, 48, 60, 72, 84, 96, 108, 120 meses) dos talhões analisados. Sendo que, foi utilizado o modelo volumétrico de Clutter (representado a seguir), do qual foram analisados seus respectivos atributos estatísticos e gráficos.

$lnV = \beta_0 + \beta_1 * \frac{1} {S} + \beta_2 * \frac{1} {Id2} + \beta_3 * \left(\frac{Id_1}{Id_2}\right) * ln(ab_1) + \beta_4 * \left( 1 - \frac{Id_1}{Id_2}\right) + \beta_5 * \left( 1 - \frac{Id_1}{Id_2}\right) * S$

A equação acima considera que:

-   $V$ = volume de madeira (m³) na idade 2;

-   $S$ = valor central da classe de sítio da parcela (m);

-   $Id$ = idade (meses);

-   $ab$ = área basal (m³/ha).

  Então, a partir das estimativas de área basal foram calculados o Incremento Corrente Anual (ICA) e o Incremento Médio Anual (IMA) para os talhões analisados, de acordo com as fórmulas apresentadas abaixo.

$IMA = \frac{V_{Id}} {Id}$

$ICA = V_{Id_2} - V_{Id_1}$

onde:

$V_{Id}$ = volume na idade n;

$Id$ = idade n.

## Análise econômica

  Com o intuito de determinar a idade ótima de corte foi realizada uma análise econômica, considerando que os anos e custos das operações foram anexados neste documento, para facilitar a visualização das premissas usadas. Logo, a partir desses dados, foi gerada uma planilha de fluxo de caixa de cada talhão analisado, com valores de Receitas e Custos para cada ano de plantio. Desse modo, os seguintes valores foram calculados: Valor Presente das Receitas (VPR), Valor Presente dos Custos (VPC), Valor Presente Líquido (VPL), Valor Presente Líquido Infinito (VPL inf), Custo Médio da Produção (CMPr), Relação Benefício Custo (B/C), Valor Esperado da Terra (VET) e a Taxa Interna de Retorno (TIR).

  A análise econômica foi realizada de forma principal através do VPL, considerando um horizonte infinito (VPL infinito), pois dessa maneira é possível comparar projetos com durações diferentes. Dessa forma os projetos foram avaliados. Algumas das fórmulas estão apresentadas abaixo:

$$VPL = VP - VPC$$

Sendo:

$VPC$ = valor presente do custo

$VP$ = valor presente

$$
VPLinf = \frac{VP(1+i)^t} {(1+i)^t-1}  = \frac{VP} {(1-(1+i)^t)}
$$

Sendo:

$t$ em anos e taxa $i$ anual

ou

$t$ em meses e taxa $i$ mensal

$$BC = \frac{VP}{VPC}$$ Em que:

$VPC$ = valor presente do custo

$$\sum_{j=0}^{n} C_j(1 + TIR)^{−j}$$

Em que:

$C_j$ = valor atual dos custos;

$j$ = período em que os custos ou receitas ocorrem;

$n$ = duração do projeto.

 

  Esses valores gerados serão devidamente comentados posteriormente neste relatório, de acordo com as interpretações geradas e suas motivações.

## Análise de sensibilidade

  Portanto, com a análise econômica florestal realizada, foram especulados cenários existentes e suas respectivas alterações em valores na taxa de juros.

# Resultados e discussão

```{r setup, include=FALSE, echo = FALSE}
library( cmrinvflor )
library( ggplot2 )
library( magick )
library( cowplot )
library( gridExtra )
library( qqplotr )
library( png )
library( openxlsx )

dados_npar <- read.csv2( "ifc.csv" )
names( dados_npar )
dados_npar <- dados_npar[ c( "parcela", "idade", "hdom", "ab", "vtsc", "vtcc" ) ]

dados <- cmrinvflor::parear_seqmed( dados_npar )
```

## Estatísticas dos modelos e classes de sítio

```{r}
## Ajustes dos modelos de classificação de sítios 

# Ajustes Bailey Clutter --------------------------------------------------

# Ajuste Bailey Clutter polimórfico

bc_poli <- "hdom2~b0*((hdom1/b0)^((idade1/idade2)^b2))"

ajbcpoli <- nls(
  formula = bc_poli,
  data = dados,
  start = list(
    b0 = 50, 
    b2 = 0.5
  )
)

#Erro padrão residual
syxbcpoli <- summary( ajbcpoli )$sigma
syxperbcpoli <- syxbcpoli / mean( dados$hdom2 ) * 100

#coeficientes bc poli
cfbcpoli <- as.vector( coef( ajbcpoli ) )

#Ajuste Bailey Clutter anamórfico

bc_ana <- "hdom2~hdom1/(exp(b1*((idade2^b2)-(idade1^b2))))"

ajbcana <- nls(
  formula = bc_ana,
  data = dados,
  start = list(
    b1 = 7.9378414, 
    b2 = -0.4497666
  )
)

#Erro padrão residual
syxbcana <- summary( ajbcana )$sigma
syxperbcana <- syxbcana / mean( dados$hdom2 ) * 100

#coeficientes bc poli
cfbcana <- as.vector( coef( ajbcana ) )

# Ajustes Chapman e Richards --------------------------------------------------

# Ajuste Chapman e Richards polimórfico

cr_poli <- "hdom2~b0*((hdom1/b0)^((log(1-exp(b1*idade2)))/(log(1-exp(b1*idade1)))))"

ajcrpoli <- nls(
  formula = cr_poli,
  data = dados,
  start = list(
    b0 = 35.2288428, 
    b1 = -0.0221952
  )
)

#Erro padrão residual
syxcrpoli <- summary( ajcrpoli )$sigma
syxpercrpoli <- syxcrpoli / mean( dados$hdom2 ) * 100

#coeficientes cr poli
cfcrpoli <- as.vector( coef( ajcrpoli ) )

#Ajuste Chapman e Richards anamórfico

cr_ana <- "hdom2~((hdom1*(1-exp(b1*(idade2))))/(1-exp(b1*(idade1))))^b2"

ajcrana <- nls(
  formula = cr_ana,
  data = dados,
  start = list(
    b1 = -0.01949213, 
    b2 = 1.05428713
  )
)

#Erro padrão residual
syxcrana <- summary( ajcrana )$sigma
syxpercrana <- syxcrana / mean( dados$hdom2 ) * 100

#coeficientes cr poli
cfcrana <- as.vector( coef( ajcrana ) )

# Ajustes Schumacher --------------------------------------------------

# Ajuste Schumacher polimórfico

sch_poli <- "hdom2~b0*((hdom1/b0)^((idade1)/(idade2)))"

ajschpoli <- nls(
  formula = sch_poli,
  data = dados,
  start = list(
    b0 = 39.1903
  )
)

#Erro padrão residual
syxschpoli <- summary( ajschpoli )$sigma
syxperschpoli <- syxschpoli / mean( dados$hdom2 ) * 100

#coeficientes sch poli
cfschpoli <- as.vector( coef( ajschpoli ) )

#Ajuste Schumacher anamórfico

sch_ana <- "hdom2~hdom1*(exp(b1*((1/idade2)-(1/idade1))))"

ajschana <- nls(
  formula = sch_ana,
  data = dados,
  start = list(
    b1 = 25.59895
  )
)

#Erro padrão residual
syxschana <- summary( ajschana )$sigma
syxperschana <- syxschana / mean( dados$hdom2 ) * 100

#coeficientes sch ana
cfschana <- as.vector( coef( ajschana ) )

```

  A Tabela 1 apresenta todos os coeficientes obtidos de cada modelo testado e seus respectivos valores de erro padrão residual. Antes de analisar os resultados, é importante salientar que quanto maior o erro padrão residual mais distante do ideal o modelo se encontra, ou seja, os resíduos estão mais distantes do valor real. Desse modo, comparando os modelos de forma **isolada a partir dessa métrica estatística** os modelos de Bailey-Clutter polimórfico e Chapman-Richards polimórfico, obtiveram os melhores resultados para as estimativas realizadas. Sendo possível destacar o polimorfismo como a forma que mais se aproxima do ideal em cada modelo testado, o que é esperado teoricamente, considerando os fatores biológicos que afetam as florestas.

| Modelos                        | $\beta_0$                 | $\beta_1$                 | $\beta_2$                | Erro padrão residual (%)   |
|--------------------------------|---------------------------|---------------------------|--------------------------|----------------------------|
| Bailey-Clutter (polimórfico)   | `r round(cfbcpoli,6)[1]`  |                           | `r round(cfbcpoli,6)[2]` | `r round(syxperbcpoli, 2)` |
| Bailey-Clutter (anamórfico)    |                           | `r round(cfbcana, 6)[1]`  | `r round(cfbcana,6)[2]`  | `r round(syxperbcana, 2)`  |
| Chapman-Richards (polimórfico) | `r round(cfcrpoli,6)[1]`  | `r round(cfcrpoli, 6)[2]` |                          | `r round(syxpercrpoli, 2)` |
| Chapman-Richards (anamórfico)  |                           | `r round(cfcrana, 6)[1]`  | `r round(cfcrana,6)[2]`  | `r round(syxpercrana, 2)`  |
| Schumacher (polimórfico)       | `r round(cfschpoli,6)[1]` |                           |                          | `r round(syxperschpoli,2)` |
| Schumacher (anamórfico)        |                           | `r round(cfschana, 6)[1]` |                          | `r round(syxperschana, 2)` |

: Coeficientes e erro padrão residual obtidos com o ajuste dos modelos.

```{r, echo=FALSE, include = FALSE}
# gráfico de sítios
# Avaliação de estabilidade dos modelos Bailey & Clutter Polimórfico e Chapman & Richards Polimórfico.

## Análise gráfica dos #ajustes

img <- image_read( "chestreelogo.PNG" )

theme_chesTree <- theme_bw( ) +
  theme( panel.grid.major = element_line( color = "gray70", linetype = "dashed" ),
         panel.grid.minor = element_blank( ),
         axis.title = element_text( size = rel( 0.7 ) ),
         axis.text = element_text( size = rel( 1.0 ) ),
         legend.position = c( 0, 1 ),
         legend.justification = c( -0.05, 1.02 ),
         legend.title = element_blank( ),
         legend.text = element_text( size = rel( 0.8 ) ) )

p <- ggplot( dados, aes( x = idade2, y = hdom2, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5) +
  #labs( title = "Testando título" ) +
  #geom_hline( yintercept = 0, linetype = "dashed" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( name = "Altura Dominante (cm)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

hdom2_idade2_plot_anexos <- ggdraw( ) +
  draw_plot( p, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.65, y = 0.02, width = 0.35, height = 0.2 )  

# A curva no gráfico acima é conhecida como LOESS 
# (suavização de dispersão estimada localmente),
# e ela nos mostra o melhor ajuste sem assumir
# que os dados devem se ajustar a alguma forma de distribuição.
# Além disso, foi apresentado o erro padrão em torno da curva em cinza.

# par( mfrow = c( 1, 1 ) )
# with( dados, plot( hdom1, hdom2, pch = 20 ) )



# Gráficos ----------------------------------------------------------------

#Calculando os resíduos

#Bailey clutter
dados$resbcpoli <- residuals( ajbcpoli ) #polimórfico
dados$resbcana <- residuals( ajbcana ) #anamórfico

#Chapman e Richards
dados$rescrpoli <- residuals( ajcrpoli ) #polimórfico
dados$rescrana <- residuals( ajcrana ) #anamórfico

#Schumacher
dados$resschpoli <- residuals( ajschpoli ) #polimórfico
dados$resschana <- residuals( ajschana ) #anamórfico

#gráficos com casca

theme_chesTree <- theme_bw( ) +
  theme( panel.grid.major = element_line( color = "gray70", linetype = "dashed" ),
         panel.grid.minor = element_blank( ),
         plot.title = element_text( size = 7 ),
         axis.title = element_text( size = rel( 0.9 ) ),
         axis.text = element_text( size = rel( 0.6 ) ),
         legend.position = c( 0, 1 ),
         legend.key = element_rect( fill = "transparent" ),
         legend.key.size = unit( 0.05, "cm" ),
         legend.justification = c( -0.01, 0.9 ),
         legend.title = element_blank( ),
         legend.text = element_text( size = rel( 0.5 ) ) )

bcnorm_poli <- ggplot( data = dados, mapping = aes( sample = resbcpoli ) ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.4 ) +
  labs( title = "Bailey-Clutter Polimórfico",
        x = "", 
        y = "" ) +
  scale_fill_discrete( "Faixas de Confiança" ) +
  theme_chesTree

bcnorm_ana <- ggplot( data = dados, mapping = aes( sample = resbcana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.4 ) +
  labs( title = "Bailey-Clutter Anamórfico",
        x = "", 
        y = "Quantil amostral" ) +
  scale_fill_discrete( "Faixas de Confiança" )+
  theme_chesTree

crnorm_poli <- ggplot( data = dados, mapping = aes( sample = rescrpoli ) ) +
  geom_qq_band( bandType = "ks", mapping = aes( fill = "KS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "ts", mapping = aes( fill = "TS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Pointwise" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.7 ) +
  labs( title = "Chapman-Richards Polimórfico",
        x = "Quantis Normais", 
        y = "Quantil Amostral" ) +
  scale_fill_discrete( "Faixas de Confiança" ) +
  theme_chesTree

crnorm_ana <- ggplot( data = dados, mapping = aes( sample = rescrana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.4 ) +
  labs( title = "Chapman-Richards Anamórfico",
        x = "Quantis Normais", 
        y = "" ) +
  scale_fill_discrete( "Faixas de Confiança" )+
  theme_chesTree

scnorm_poli <- ggplot( data = dados, mapping = aes( sample = resschpoli ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.4 ) +
  labs( title = "Shcumacher Polimórfico",
        x = "Quantis Normais", 
        y = "Quantil amostral" ) +
  scale_fill_discrete( "Faixas de Confiança" )+
  theme_chesTree

scnorm_ana <- ggplot( data = dados, mapping = aes( sample = resschana ) ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Normal" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.4 ) +
  labs( title = "Schumacher Anamórfico",
        x = "Quantis Normais", 
        y = "" ) +
  scale_fill_discrete( "Faixas de Confiança" )+
  theme_chesTree

# "pointwise" constrói bandas de confiança simultâneas com base na distribuição normal;
# "boot" cria bandas de confiança pontuais com base em um boostrap paramétrico;
# "ks" constrói bandas de confiança simultâneas com base em uma inversão do teste de Kolmogorov-Smirnov;
# "ts" constrói bandas de confiança sensíveis à cauda, como proposto por Aldor-Noiman et al. (2013).

margin <- theme( plot.margin = unit( c( 0, 0, 0, 0 ), "cm" ) )

arranged_norm <- grid.arrange(
                               grobs = lapply( list( bcnorm_ana, bcnorm_poli, crnorm_ana,
                               scnorm_poli, scnorm_ana ), "+", margin ), 
                               heights = c( 4,4 ) )
# anexos
norm_plot_anexos <- ggdraw( ) +
  draw_plot( arranged_norm, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.66, y = 0.02, width = 0.35, height = 0.65 )  


## Resíduos

res_plot_bcpoli <- ggplot( dados, aes( x = idade1, y = resbcpoli, color = "lightgreen" ) ) +
  geom_point( size = 0.9 , alpha = 0.5 ) +
  labs( title = "Bailey-Clutter Polimórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c(-8, -4, 0, 4, 8 ), name = "" ) +
  scale_x_continuous( name = "" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

# anexos
res_plot_bcana <- ggplot( dados, aes( x = idade1, y = resbcana, color = "lightgreen" ) ) +
  geom_point( size = 0.9 , alpha = 0.5 ) +
  labs( title = "Bailey-Clutter Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( name = "" ,
                      limits = c( -8, 8 ), breaks = c( -8, -4, 0, 4, 8  ) ) +
  scale_x_continuous( name = "" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_crpoli <- ggplot( dados, aes( x = idade1, y = rescrpoli, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c( -8, -4, 0, 4, 8  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

arranged_res_norm <- grid.arrange( crnorm_poli, res_plot_crpoli, ncol = 2 )

res_norm_plot <- ggdraw( ) +
  draw_plot( arranged_res_norm, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.35, y = 0.02, width = 0.35, height = 0.2 )  

res_plot_crana <- ggplot( dados, aes( x = idade1, y = rescrana, color = "lightgreen" ) ) +
  geom_point( size = 0.9 , alpha = 0.5 ) +
  labs( title = "Chapman-Richards Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c(-8, -4, 0, 4, 8 ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_schpoli <- ggplot( dados, aes( x = idade1, y = resschpoli, color = "lightgreen" ) ) +
  geom_point( size = 0.9 , alpha = 0.5 ) +
  labs( title = "Schumacher Polimórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( name = "" ,
                      limits = c( -8, 8 ), breaks = c(-8, -4, 0, 4, 8 ), 
                      ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

res_plot_schana <- ggplot( dados, aes( x = idade1, y = resschana, color = "lightgreen" ) ) +
  geom_point( size = 0.9 , alpha = 0.5 ) +
  labs( title = "Schumacher Anamórfico" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -8, 8 ), breaks = c(-8, -4, 0, 4, 8 ), name = "" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

margin <- theme( plot.margin = unit( c( 0.01, 0.0001, 0.0001, 0.2 ), "cm" ) )
arranged_res <- grid.arrange( ncol = 2, nrow = 3, 
                              grobs = lapply( list( res_plot_bcpoli, res_plot_bcana, 
                              res_plot_crana,
                              res_plot_schpoli, res_plot_schana ), "+", margin ) )
# anexos
res_plot_anexos <- ggdraw( ) +
  draw_plot( arranged_res, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.58, y = 0.02, width = 0.35, height = 0.5 )  

```

```{r}
#| fig-cap: Gráfico quantil-quantil e gráfico da distribuição de resíduos do modelo de Chapman-Richards (polimórfico).

res_norm_plot

```

\newpage

  Dessa forma, o modelo de Chapman-Richards foi o modelo escolhido, pois além do seu desempenho através da métrica citada anteriormente ter sido o superior, esse foi o modelo que apresentou a melhor distribuição de resíduos devido os resultados estarem mais agrupados em torno do zero (Figura 1), quando comparado com as distribuições dos demais modelos testados a um nível de significância de 5%, os quais estão anexados neste documento.

  Ademais, também na Figura 1, é foram geradas faixas de confiança simultâneas com base na distribuição normal, técnica conhecida como *Pointwise*; faixas de confiança pontuais com base em um bootstrap paramétrico; bandas de confiança simultâneas com base em uma inversão do teste de Kolmogorov-Smirnov (KS) e faixas de confiança sensíveis à cauda, como proposto por [@aldor2013power]. E a reta estimada estava contida dentro desses intervalos, para todas as técnicas citadas, afirmando normalidade.

  Outrossim, com o intuito de comparar as estabilidades entre parcelas dos modelos, foi processada a classificação de sítio. Com isso, foi possível gerar comparações como as destacadas na frequência das mudanças de classe observadas na Tabela 2, a qual apresenta a comparação entre os dois melhores modelos. Sendo que, essa mesma análise para os demais modelos está disponível em anexo deste documento, assim como os gráficos das curvas de índice de sítio das alturas dominantes, distribuídas em intervalos de classes, em função do tempo para cada modelo.

| Modelos                        | Migração de classes | Ocorrências | Porcentagem |
|--------------------------------|---------------------|-------------|-------------|
|                                | 0                   | 83          | 36.56       |
| Bailey-Clutter (polimórfico)   | 1                   | 131         | 57.71       |
|                                | 2                   | 13          | 5.73        |
|                                |                     |             |             |
|                                | 0                   | 90          | 39.65       |
| Chapman-Richards (polimórfico) | 1                   | 123         | 54.19       |
|                                | 2                   | 14          | 6.17        |

: Teste de estabilidade das parcelas para os melhores modelos testados.

  O modelo Chapman-Richards Polimórfico apesar de estar um pouco abaixo da estabilidade observada no modelo de Bailey-Clutter, os dados apresentam pouca diferança, e por conta da sua superioridade nos demais quesitos observados, o modelo escolhido foi o de Chapman-Richards polimórfico.

![Distribuição das alturas dominantes em função da idade para modelo Chapman-Richards Polimórfico e seus respectivos limites.](curva_indice_sitio_cr_polimorfico.jpeg){width="70%"}

## Prognose e idade ótima de corte

\ Baseado na reclassificação dos sítios, para cada parcela, foram selecionadas as três fazendas (Tabela 3) em função da distância da fábrica, situada em Guapiara-SP.

```{r}
#Ajuste do modelo de Clutter
ifc <- read.csv2( "ifc.csv" )
ifc <- ifc[ c( "parcela","idade","ab", "vtcc", "vtsc", "s" ) ] 

ifcp <- parear_seqmed( ifc )

names( ifcp ) <- v_from_to( names( ifcp ), "s1", "s" )

ifcp$s2 <- NULL

aj <- lm( "log(vtcc2)~I(1/s)+I(1/idade2)+
           I((idade1/idade2)*log(ab1))+
           I(1-idade1/idade2)+I((1-idade1/idade2)*s)",
           ifcp )

sumario <- summary( aj )

# coeficiente de determinação
R2 <- round( sumario$r.squared * 100, 2 )

# erro padrão residual m³
syx_log <- sumario$sigma

dvtcc2 <- 1 / ifcp$vtcc2

medgeo <- exp( mean( log( dvtcc2 ) ) )

ifurnival <- round( 1 / medgeo * sumario$sigma, 2 )
ifurnival_perc <- round( ifurnival /mean( ifcp$vtcc2 ) * 100, 2 )

#Fator de correção da discrepância logaritmica
#de Meyer
fc <- exp( 0.5 * sumario$sigma ^ 2 )
vtcc_est <- exp( predict( aj ) ) * fc

bs <- coef( aj )

#pegar a ultima medição de cada parcela
ultmed <- aggregate( list( max_id = ifc$idade ),
                     list( parcela = ifc$parcela ),
                     max )

ifc <- merge( ifc, ultmed )

ifc_ultmed <- subset( ifc, idade == max_id )

#Estimar os volumes nas diferentes idades
idadeprog <- 24;      #(24 meses=2anos)

#bs ? valores de betas, guardou-os na posição 1,2,.. pq no R a matriz come?a na posi??o 1! igual no excel, s? q n?o devia.
ifc_ultmed$vtcc2 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s))

idadeprog <- 36
ifc_ultmed$vtcc3 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 48
ifc_ultmed$vtcc4 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 60
ifc_ultmed$vtcc5 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 72
ifc_ultmed$vtcc6 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 84
ifc_ultmed$vtcc7 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 96
ifc_ultmed$vtcc8 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 108
ifc_ultmed$vtcc9 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

idadeprog <- 120
ifc_ultmed$vtcc10 <- with(ifc_ultmed, exp(bs[1]+bs[2]/s+bs[3]/idadeprog+bs[4]*(idade/idadeprog)*log(ab)+bs[5]*(1-idade/idadeprog)+bs[6]*(1-idade/idadeprog)*s));

#Calcular os IMAs
ifc_ultmed$ima2 <- ifc_ultmed$vtcc2 / 2
ifc_ultmed$ima3 <- ifc_ultmed$vtcc3 / 3
ifc_ultmed$ima4 <- ifc_ultmed$vtcc4 / 4
ifc_ultmed$ima5 <- ifc_ultmed$vtcc5 / 5
ifc_ultmed$ima6 <- ifc_ultmed$vtcc6 / 6
ifc_ultmed$ima7 <- ifc_ultmed$vtcc7 / 7
ifc_ultmed$ima8 <- ifc_ultmed$vtcc8 / 8
ifc_ultmed$ima9 <- ifc_ultmed$vtcc9 / 9
ifc_ultmed$ima10 <- ifc_ultmed$vtcc10 / 10

#Calcular ICAs
ifc_ultmed$ica3 <- with( ifc_ultmed, vtcc3 - vtcc2 )
ifc_ultmed$ica4 <- with( ifc_ultmed, vtcc4 - vtcc3 )
ifc_ultmed$ica5 <- with( ifc_ultmed, vtcc5 - vtcc4 )
ifc_ultmed$ica6 <- with( ifc_ultmed, vtcc6 - vtcc5 )
ifc_ultmed$ica7 <- with( ifc_ultmed, vtcc7 - vtcc6 )
ifc_ultmed$ica8 <- with( ifc_ultmed, vtcc8 - vtcc7 )
ifc_ultmed$ica9 <- with( ifc_ultmed, vtcc9 - vtcc8 )
ifc_ultmed$ica10 <- with( ifc_ultmed, vtcc10 - vtcc9 )

#write.csv2( ifc_ultmed, "prognosecerto.csv", row.names = F )

```

  Portanto, foram selecionadas as três fazendas: Júlio de Mesquita, Santa Bárbara e Montreal. As quais tiveram seus principais dados explicitados na Tabela 3.

| Fazenda           | Talhão | Parcela | Idade (meses) | Área basal (cm²) | Sítio | Distância (km) |
|-------------------|--------|---------|---------------|------------------|-------|----------------|
| Montreal          | 7      | 15      | 75            | 26.58            | 23.4  | 86.22          |
| Santa Bárbara     | 41     | 71      | 61.86         | 30.15            | 28    | 114.97         |
| Júlio de Mesquita | 103    | 196     | 75.76         | 31.83            | 30.3  | 152.06         |

: Informações das fazendas em relação às distâncias para a fábrica contratante.

 Para o cálculo das estimativas de volume, foi usado o modelo de Clutter, o qual gerou os parâmetros demonstrados na Tabela 4, sendo posteriormente avaliado pelas métricas dispostas na Tabela 5, as quais apresentaram uma boa confiabilidade, considerando que 95.26% das variações da variável dependente são explicadas pelas variações das variáveis independentes. Além disso, também foi realizada a análise gráfica deste modelo, a qual foi dentro do esperado em relação à variância, afirmando normalidade para os diferentes intervalos estatísticos testados (Figura 3).

|        | $\beta_0$   | $\beta_1$  | $\beta_2$  | $\beta_3$   | $\beta_4$   | $\beta_5$   |
|--------|-------------|------------|------------|-------------|-------------|-------------|
| Coefs. | 2.673020758 | -19.572384 | -18.535522 | 1.223599895 | 4.424411929 | 0.009277004 |

: Parâmetros do modelo volumétrico de Clutter.

| Modelo  | Erro padrão residual (m³) | R² (%) | Índice de Furnival (%) |
|---------|---------------------------|--------|------------------------|
| Clutter | `r syx_log`               | `r R2` | `r ifurnival_perc`     |

: Estatísticas do modelo de Clutter.

```{r}
#| fig-cap: Gráfico quantil-quantil e gráfico da distribuição de resíduos do modelo de Clutter.

ifcp$resclutter <- residuals( aj ) #polimórfico

resclutter <- ggplot( data = ifcp, mapping = aes( sample = resclutter ) ) +
  geom_qq_band( bandType = "ks", mapping = aes( fill = "KS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "ts", mapping = aes( fill = "TS" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "boot", mapping = aes( fill = "Bootstrap" ), alpha = 0.5 ) +
  geom_qq_band( bandType = "pointwise", mapping = aes( fill = "Pointwise" ), alpha = 0.5 ) +
  stat_qq_line( ) +
  stat_qq_point( size = 0.7 ) +
  labs( title = "Clutter",
        x = "Quantis Normais", 
        y = "Quantil Amostral" ) +
  scale_fill_discrete( "Faixas de Confiança" ) +
  theme_chesTree

res_plot_clutter <- ggplot( ifcp, aes( x = idade1, y = resclutter, color = "lightgreen" ) ) +
  geom_point( size = 1.5 , alpha = 0.5 ) +
  labs( title = "" ) +
  geom_hline( yintercept = 0, col = "black" ) +
  geom_smooth( se = TRUE, method = "loess", formula = "y ~ x" ) +
  scale_y_continuous( limits = c( -1, 1 ), breaks = c( 1, -0.5, 0, 0.5, 1  ), name = "Resíduos (m)" ) +
  scale_x_continuous( name = "Idade (meses)" ) +
  scale_color_manual( values = c( "#50B23D","#0072B2" ), guide = "none" ) +
  scale_fill_manual( values = c( "#E69F00","#0072B2" ), guide = "none" ) +
  theme_chesTree

arranged_res_norm_clutter <- grid.arrange( resclutter, res_plot_clutter, ncol = 2 )

res_norm_plot <- ggdraw( ) +
  draw_plot( arranged_res_norm_clutter, x = 0, y = 0.15, width = 1, height = 0.85 ) +
  draw_image( img, x = 0.35, y = 0.02, width = 0.35, height = 0.2 )  
```

```{r}
#| fig-cap: Curva de Crescimento e Curvas de IMA e ICA com Idade Ótima de Corte destacada em ambos gráficos da Fazenda Montreal.

#Dados da última medição parcela 7
#Idade presente (meses)
idade1 <- 75
#Área basal presente (m²/ha)
ab1 <- 26.58
#Sítio 23,4 (metros)
s <- 23.4

#Aplicação do modelo de Clutter

b0 <- bs[ 1 ] 
b1 <- bs[ 2 ] 
b2 <- bs[ 3 ]
b3 <- bs[ 4 ]   
b4 <- bs[ 5 ]   
b5 <- bs[ 6 ]
#' estimar a curva de produção (senóide)
eqvol <- expression( exp( b0 + b1 / s + b2 / x + b3 * ( idade1 / x ) * log( ab1 ) +
                            b4 * ( 1 - idade1 / x ) + b5 * ( 1 - idade1 / x ) * s ) 
)
#' gerando incremento

#D( eqvol, "x" )
der_eqvol <-  expression( exp(b0 + b1/s + b2/x + b3 * (idade1/x) * log(ab1) + 
                                b4 * (1 - idade1/x) +
                                b5 * (1 - idade1/x) * s) * (b4 * (idade1/x^2) - 
                                                              (b3 * (idade1/x^2) * log(ab1) + b2/x^2) + b5 * (idade1/x^2) * 
                                                              s)
)

vtcc <- function( x ) eval( eqvol )

#' incremento corrente médio
icm <- function( x ) eval( der_eqvol )

#' incremento médio mensal
imn <- function( x ) vtcc( x ) / x

#' Definição da idade ótima de corte silvicultural

# Opção 1

op <- optimise( f = imn, interval = c( 12, 120 ), maximum = TRUE )
iocs <- op$maximum / 12

#' Opção 2
fo <- function( x ) abs( icm( x ) - imn( x ) )
op <- optimise( f = fo, interval = c( 12, 120 ), maximum = FALSE )
iocs <- op$minimum / 12

my_image <- readPNG( "chestreelogo.PNG" )

#' Adicionando idade ótima de corte no gráfico
lim <- par( mfrow = c( 2, 1 ),
            pch = 20,
            bty = "l",
            mai = c( 0.8, 0.9, 0.1, 0.4 ) )

curve( vtcc( x ), 12, 120, xlab = "", ylab = "vtcc (m³/ha)" )
curve( icm( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "icm (m³/ha.ano)", col = "red" )
curve( imn( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "ima (m³/ha.ano)", add = TRUE, col = "green" )
legend( "topright", c( "ICA", "IMA" ), text.col = c( "red", "green" ), box.lty = 0,
        col = c( "red", "green" ), lty = c( 1, 1 ) )
par( xpd = NA )
abline( v = iocs * 12, col = "black", lty = 2 )

rasterImage( my_image, 
             xleft = 90, xright = 124, 
             ybottom = 70, ytop = 85 )

text( 65, 60, paste( round( iocs, 2 ), " anos" ), cex = 0.8 )


```

```{r}
#| fig-cap: Curva de Crescimento e Curvas de IMA e ICA com Idade Ótima de Corte destacada em ambos gráficos da Fazenda Santa Bárbara.

# -- Fazenda 
# id1 para talhao 41 é = 61,86
# ab1 para talhao 41  é = 30,15
# s para talhao 41 é = 28


#Dados da última medição parcela 110
#Idade presente (meses)
idade1 <- 61.86
#Área basal presente (m²/ha)
ab1 <- 30.15
#Sítio 28 (metros)
s <- 28


#Aplicação do modelo de Clutter

b0 <- bs[ 1 ] 
b1 <- bs[ 2 ] 
b2 <- bs[ 3 ]
b3 <- bs[ 4 ]   
b4 <- bs[ 5 ]   
b5 <- bs[ 6 ]
#' estimar a curva de produção (senóide)
eqvol <- expression( exp( b0 + b1 / s + b2 / x + b3 * ( idade1 / x ) * log( ab1 ) +
                            b4 * ( 1 - idade1 / x ) + b5 * ( 1 - idade1 / x ) * s ) 
)
#' gerando incremento

#D( eqvol, "x" )
der_eqvol <-  expression( exp(b0 + b1/s + b2/x + b3 * (idade1/x) * log(ab1) + 
                                b4 * (1 - idade1/x) +
                                b5 * (1 - idade1/x) * s) * (b4 * (idade1/x^2) - 
                                                              (b3 * (idade1/x^2) * log(ab1) + b2/x^2) + b5 * (idade1/x^2) * 
                                                              s)
)

vtcc <- function( x ) eval( eqvol )

#' incremento corrente médio
icm <- function( x ) eval( der_eqvol )

#' incremento médio mensal
imn <- function( x ) vtcc( x ) / x

#' Definição da idade ótima de corte silvicultural

# Opção 1

op <- optimise( f = imn, interval = c( 12, 120 ), maximum = TRUE )
iocs <- op$maximum / 12

#' Opção 2
fo <- function( x ) abs( icm( x ) - imn( x ) )
op <- optimise( f = fo, interval = c( 12, 120 ), maximum = FALSE )
iocs <- op$minimum / 12

my_image <- readPNG( "chestreelogo.PNG" )

#' Adicionando idade ótima de corte no gráfico
lim <- par( mfrow = c( 2, 1 ),
            pch = 20,
            bty = "l",
            mai = c( 0.8, 0.9, 0.1, 0.4 ) )

curve( vtcc( x ), 12, 120, xlab = "", ylab = "vtcc (m³/ha)" )
curve( icm( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "icm (m³/ha.ano)", col = "red" )
curve( imn( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "ima (m³/ha.ano)", add = TRUE, col = "green" )
legend( "topright", c( "ICA", "IMA" ), text.col = c( "red", "green" ), box.lty = 0,
        col = c( "red", "green" ), lty = c( 1, 1 ) )
par( xpd = NA )
abline( v = iocs * 12, col = "black", lty = 2 )

rasterImage( my_image, 
             xleft = 90, xright = 130, 
             ybottom = 105, ytop = 130 )

text( 60, 90, paste( round( iocs, 2 ), " anos" ), cex = 0.8 )

```

```{r}
#| fig-cap: Curva de Crescimento e Curvas de IMA e ICA com Idade Ótima de Corte destacada em ambos gráficos da Fazenda Júlio de Mesquita.

# -- Fazenda 
# id1 para talhao 103 é = 75,76
# ab1 para talhao 103 é = 31,83
# s para talhao 103 é = 30,3

#Dados da última medição parcela 89
#Idade presente (meses)
idade1 <- 75.76
#Área basal presente (m²/ha)
ab1 <- 31.83
#Sítio 30,3 (metros)
s <- 30.3

#Aplicação do modelo de Clutter

b0 <- bs[ 1 ] 
b1 <- bs[ 2 ] 
b2 <- bs[ 3 ]
b3 <- bs[ 4 ]   
b4 <- bs[ 5 ]   
b5 <- bs[ 6 ]
#' estimar a curva de produção (senóide)
eqvol <- expression( exp( b0 + b1 / s + b2 / x + b3 * ( idade1 / x ) * log( ab1 ) +
                            b4 * ( 1 - idade1 / x ) + b5 * ( 1 - idade1 / x ) * s ) 
)
#' gerando incremento

#D( eqvol, "x" )
der_eqvol <-  expression( exp(b0 + b1/s + b2/x + b3 * (idade1/x) * log(ab1) + 
                                b4 * (1 - idade1/x) +
                                b5 * (1 - idade1/x) * s) * (b4 * (idade1/x^2) - 
                                                              (b3 * (idade1/x^2) * log(ab1) + b2/x^2) + b5 * (idade1/x^2) * 
                                                              s)
)

vtcc <- function( x ) eval( eqvol )

#' incremento corrente médio
icm <- function( x ) eval( der_eqvol )

#' incremento médio mensal
imn <- function( x ) vtcc( x ) / x

#' Definição da idade ótima de corte silvicultural

# Opção 1

op <- optimise( f = imn, interval = c( 12, 120 ), maximum = TRUE )
iocs <- op$maximum / 12

#' Opção 2
fo <- function( x ) abs( icm( x ) - imn( x ) )
op <- optimise( f = fo, interval = c( 12, 120 ), maximum = FALSE )
iocs <- op$minimum / 12

my_image <- readPNG( "chestreelogo.PNG" )

#' Adicionando idade ótima de corte no gráfico
lim <- par( mfrow = c( 2, 1 ),
            pch = 20,
            bty = "l",
            mai = c( 0.8, 0.9, 0.1, 0.4 ) )

curve( vtcc( x ), 12, 120, xlab = "", ylab = "vtcc (m³/ha)" )
curve( icm( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "icm (m³/ha.ano)", col = "red" )
curve( imn( x )* 12, 12, 120, xlab = "idade (meses)", ylab = "ima (m³/ha.ano)", add = TRUE, col = "green" )
legend( "topright", c( "ICA", "IMA" ), text.col = c( "red", "green" ), box.lty = 0,
        col = c( "red", "green" ), lty = c( 1, 1 ) )
par( xpd = NA )
abline( v = iocs * 12, col = "black", lty = 2 )

rasterImage( my_image, 
             xleft = 90, xright = 130, 
             ybottom = 105, ytop = 130 )

text( 65, 100, paste( round( iocs, 2 ), " anos" ), cex = 0.8 )

```

  A partir das Figuras 4, 5 e 6, torna-se perceptível as diferenças na idade técnica de corte (período de maior Incremento Médio Anual) para cada fazenda, considerando a relação inversa com a qualidade do sítio, de acordo com o que se espera na teoria, quanto melhor o sítio maior o IMA (Incremento Médio Anual), logo, mais rápido as plantas atingirão a idade ótima para corte (IOC/ITC). No entanto, a fazenda Santa Bárbara, a qual está contida no sítio 28, apresentou uma IOC mais curta do que a fazenda Júlio de Mesquita, a qual está contida no sítio 30.3. Ou seja, é possível inferir que devido às condições menos favoráveis existentes na fazenda Santa Bárbara, não vale a pena manter a floresta em pé, devido a sua permanência no campo não representar um maior desenvolvimento.

# Análise econômica

  É importante salientar que análises ecônomicas de plantios florestais, assim como em outras áreas variam drasticamente de acordo com o período e região a qual são levantados os custos. Desse modo, na Tabela 6 estão apresentados esses custos referentes ao período do levantamento realizado.

| Itens                    | Ano   | Valor            |
|--------------------------|-------|------------------|
| Implantação              | 0     | 8000.00 (R\$/ha) |
| Capina                   | 1     | 275.00 (R\$/ha)  |
| Roçada                   | 2     | 135.00 (R\$/ha)  |
| Bateção pré-corte        | Corte | 100.00 (R\$/ha)  |
| Proteção e consevação    | Corte | 40.00 (R\$/ha)   |
| Colheita                 | Corte | 20.00 (R\$/ha)   |
| Venda                    | Corte | 140.00 (R\$/ha)  |
| Despesas administrativas | \-    | 20.00 (R\$/ha)   |

: Informações dos custos de manutenção/implantação do plantio.

  Desse modo, foi elaborado a análise de viabilidade econômica tendo como o principal atributo o Valor Presente Líquido (VPL). O qual é um método capaz de trazer para data zero, todos os fluxos de caixa de um projeto de investimento e então somá-los ao valor do investimento realizando inicialmente, para isso é utilizado a Taxa Mínima de Atratividade (TMA) do projeto, a qual foi considerada 10%.

  Na Tabela 7 estão os valores estimados de frete, os quais variam de acordo com cada fazenda e suas respectivas distâncias, e o custo da terra. Esse último apresenta uma grande variação na região das fazendas, segundo os valores cotados com base no Instituto de Economia Agrícola (IEA) para o ano de 2021, já que no ano de 2022 ainda não foram realizados levantamentos pelo IEA [@precor].

| Fazendas          | Cidade  | Custo da Terra (R\$/ha) | Transporte (R\$/km/m³) |
|-------------------|---------|-------------------------|------------------------|
| Montreal          | Buri    | 21000                   | 0.10                   |
| Santa Bárbara     | Itaberá | 17000                   | 0.11                   |
| Júlio de Mesquita | Itaí    | 15000                   | 0.112                  |

: Informações atreladas aos custos da Terra e frete.

```{r}
#| label: fig-charts
#| fig-cap: Fazendas com VPL negativo.
#| fig-subcap: 
#|   - "Fazenda Montreal"
#|   - "Fazenda Santa Bárbara"
#| layout-ncol: 2

options(warn=-1)
talhao7 <- read.xlsx( "custos_talhao_7_parcela_15.xlsx", sheet = "custos_talhao_7_parcela_15" )
talhao41 <- read.xlsx( "custos_talhao_41_parcela_71.xlsx", sheet = "custos_talhao_41_parcela_71" )
talhao103 <- read.xlsx( "custos_talhao_103_parcela_196.xlsx", sheet = "custos_talhao_103_parcela_196" )

vpl_talhao_7 <- as.numeric( talhao7[ talhao7$`Terra.(R$/ha)` == "VPL", ] )
vpl_talhao_41 <- as.numeric( talhao41[ talhao41$`Terra.(R$/ha)` == "VPL", ] )
vpl_talhao_103 <- as.numeric( talhao103[ talhao103$`Terra.(R$/ha)` == "VPL", ] )

vpl_talhao_7 <- vpl_talhao_7[ 2:9 ]
vpl_talhao_41 <- vpl_talhao_41[ 2:9 ]
vpl_talhao_103 <- vpl_talhao_103[ 2:9 ]

anos <- 3:10

df_vpl_talhao_7 <- data.frame( VPL = vpl_talhao_7, anos = anos )
df_vpl_talhao_41 <- data.frame( VPL = vpl_talhao_41, anos = anos )
df_vpl_talhao_103 <- data.frame( VPL = vpl_talhao_103, anos = anos )



theme_chesTree <- theme_bw( ) +
  theme( panel.grid.major = element_line( color = "gray70", linetype = "dashed" ),
         panel.grid.minor = element_blank( ),
         axis.title = element_text( size = rel( 0.8 ) ),
         axis.text = element_text( size = rel( 0.8 ) ),
         legend.position = c( 0, 1 ),
         legend.justification = c( -0.05, 1.02 ),
         legend.title = element_blank( ),
         legend.text = element_text( size = rel( 0.8 ) ) )


ggplot( data = df_vpl_talhao_7, aes( x = anos, y = VPL, label = round( VPL, 2 ) ) ) +
  geom_point( ) +
  geom_text( data = df_vpl_talhao_7[ df_vpl_talhao_7$VPL < 0, ], colour = "red", vjust = -0.1 ) +
  geom_text( data = df_vpl_talhao_7[ df_vpl_talhao_7$VPL > 0, ], colour = "green" ) +
  geom_line( ) +
  theme_chesTree

ggplot( data = df_vpl_talhao_41, aes( x = anos, y = VPL, label = round( VPL, 2 ) ) ) +
  geom_point( ) +
  geom_text( data = df_vpl_talhao_41[ df_vpl_talhao_41$VPL < 0, ], colour = "red", vjust = -0.1 ) +
  geom_text( data = df_vpl_talhao_41[ df_vpl_talhao_41$VPL > 0, ], colour = "green" ) +
  geom_line( ) +
  theme_chesTree

# margin <- theme( plot.margin = unit( c( 0.1, 0.1, 0.1, 0.2 ), "cm" ) )
# vpls <- grid.arrange( grobs = lapply( list( plot_vpl_talhao_7, plot_vpl_talhao_41,
#                                             plot_vpl_talhao_103 ), "+", margin ),
#                       ncol = 2 )
# # anexos
# ggdraw( ) +
#   draw_plot( vpls, x = 0, y = 0.15, width = 1, height = 0.85 ) +
#   draw_image( img, x = 0.35, y = 0.002, width = 0.35, height = 0.2 )

```


```{r}
#| fig-cap: VPL fazenda Júlio de Mesquita.
#| layout-ncol: 1

ggplot( data = df_vpl_talhao_103, aes( x = anos, y = VPL, label = round( VPL, 2 ) ) ) +
  geom_point( ) +
  geom_text( data = df_vpl_talhao_103[ df_vpl_talhao_103$VPL < 0, ], colour = "red", vjust = -0.1 ) +
  geom_text( data = df_vpl_talhao_103[ df_vpl_talhao_103$VPL > 0, ], colour = "green" ) +
  geom_line( ) +
  theme_chesTree

```

\  De acordo com os resultados das Figuras 7 e 8, gerados no Excel (Tabelas  em anexo), torna-se indubitável que a fazenda Júlio de Mesquita, a qual possui o melhor sítio e está mais distante da fábrica em Guapiara-SP, apresentou o maior VPL aos 6 anos (R$3.399,39/ha). Enquanto que as demais fazendas apresentaram VPL negativo em todas as idades, indicando um negócio inviável, nos parâmetros econômicos utilizados neste relatório.

\ Os resultados da TIR (14,96%) da fazenda Júlio de Mesquita superam a Taxa Mínima de Atratividade (TMA) de 10%, a partir do sexto ano de rotação até o nono ano. Demonstrando viabilidade econômica durante este período, indicando que enquanto a TMA for menor que a TIR é recomendado investir no plantio florestal, de acordo com as estimativas realizadas. Já as demais fazendas diante dessa perspectiva, são inviáveis economicamente, ou seja, apresentam TIR abaixo da TMA. A Figura 9 ilustra a IOC para o VPL infinito, cujo valor permite comparar os diferentes anos de corte para um projeto com horizonte infinito.

```{r}
#| fig-cap: IOC para VPL infinito estimado da Fazenda Júlio de Mesquita.

# custo da terra deve ser importado do excel sendo 0!
fc <- read.xlsx( "custos_talhao_103_parcela_196.xlsx", sheet = "Plan2", rowNames = FALSE )
valor_terra <- 15000

# taxa de juros
tj <- 0.1

fc$custo_sem_terra <- fc$custo
ii <- fc$idade != 0
fc$custo[ ii ] <- fc$custo_sem_terra[ ii ] + valor_terra * tj

# avaliação econômica
ae <- avecon( fc[, 1:5 ], tj, valor_terra, TRUE )
j <- match( max( ae$vplinf ), ae$vplinf )

# idade ótima de corte VPL infinito
plot( ae$projeto, ae$vplinf, type = "b", col = 1 , xlab = "Idade de Rotação", 
      ylab = "VPL infinito" )
abline( v = ae$projeto[ j ], lty = 2 )
legend("topright", legend = "IOC", lty = 2)

```

## Sensibilidade econômica

\ As taxas de juros são o principal impacto nas florestas brasileiras quando comparamos com aquelas situados fora do país, isso se deve ao fato de que as taxas no Brasil são muito elevadas, logo, se as florestas crescessem na velocidade das florestas do Canadá por exemplo, com rotações de até 70 anos, ninguém no Brasil investiria em florestas.
Sendo assim, considerando a sua possível grande variação na taxa de juros e seu alto impacto mesmo em curtos períodos no país tornando alguns projetos inviáveis. Faz-se necessário portanto partindo deste princípio, a análise de sensibilidade, facilitando ao investidor e permitindo uma visão holística do projeto para diferentes cenários relacionados as taxas de juros (Figura 10).    


```{r}
#| fig-cap: Variações no VPL infinito para diferentes taxas de juros.

# custo da terra deve ser importado do excel sendo 0!
fc <- read.xlsx( "custos_talhao_103_parcela_196.xlsx", sheet = "Plan2", rowNames = FALSE )
fc$custo_sem_terra <- fc$custo

# Simulação, variando taxa de juros
valor_terra <- 10000
tj <- seq( from = 0.09, to = 0.13, by = 0.01 )

ii <- fc$idade != 0

for( i in 1:length( tj ) ) {
  
  fc$custo[ ii ] <- fc$custo_sem_terra[ ii ] + valor_terra * tj[ i ]
  
  # avaliação econômica
  ae <- avecon( fc[, 1:5 ], tj = tj[ i ], valor_terra, TRUE )
  
  # idade ótima de corte
  if( i == 1 ){
    with( ae, plot( projeto, vplinf, 
                    xlab = "Idade de Rotação", 
                    ylab = "VPL infinito",
                    ylim = c( 0, max( ae$vplinf ) ), 
                    type = "b", col = i ) ) 
  } else {
    with( ae, lines( projeto, vplinf, type = "b", col = i ) )
  }
  
}

legend( "topright", legend = paste0( tj*100, "%"), text.col = 1:length(tj), bty ="n", horiz = T )
```

\ Esses dados são referentes apenas à fazenda escolhida na seção de Análise Econômica, devido a inviabilidade dos demais projetos em relação a fazenda Júlio de Mesquita. Além disso, a TIR variou entre 15,94% (9% taxa de juros) à 12,06% (13% taxa de juros), indicando a viabilidade do projeto em diferentes cenários de variação da taxa de juros.  

\newpage

# Conclusão

\ Dessa forma, foi possível concluir que o projeto com aquisição da terra com o objetivo de realizar plantio florestal de _Eucalyptus_ sp.; no município de Itaí, fazenda Júlio de Mesquita, demonstrou-se viável em diferentes cenários, através das premissas levantadas neste relatório. Isso se deve aos indicativos econômicos e estatísticos estimados pelo autor para chegar na recomendação final, considerando que os demais projetos nas cidades de Buri e Itaberá não apresentaram viabilidade econômica para abastecer a fábrica situada em Guapiara-SP.

\newpage

# Referências {.unnumbered}

::: {#refs}
:::

\newpage

**Anexos**

 

```{r}
#| fig-cap: Gráficos da distribuição de resíduos dos modelos que não foram selecionados.

res_plot_anexos
```

```{r}
#| fig-cap: Gráficos quantil-quantil dos modelos que não foram selecionados.

norm_plot_anexos
```

| Modelos                      | Migração de classes | Ocorrências | Porcentagem |
|------------------------------|---------------------|-------------|-------------|
|                              | 0                   | 78          | 34.36       |
| Bailey-Clutter (polimórfico) | 1                   | 135         | 59.47       |
|                              | 2                   | 14          | 6.17        |
|                              |                     |             |             |
|                              | 0                   | 80          | 35.24       |
| Bailey-Clutter (polimórfico) | 1                   | 130         | 57.27       |
|                              | 2                   | 17          | 7.49        |
|                              |                     |             |             |
|                              | 0                   | 84          | 37          |
| Bailey-Clutter (polimórfico) | 1                   | 129         | 56.83       |
|                              | 2                   | 14          | 6.17        |
|                              |                     |             |             |
|                              | 0                   | 70          | 30.84       |
| Bailey-Clutter (polimórfico) | 1                   | 140         | 61.67       |
|                              | 2                   | 17          | 7.49        |

: Teste de estabilidade das parcelas para os modelos não selecionados


![Valores gerados para talhão 7 - Fazenda Montreal.](excel_custos_7.PNG)

![Valores gerados para talhão 41 - Fazenda Santa Bárbara.](excel_custos_41.PNG)

![Valores gerados para talhão 103 - Fazenda Júlio de Mesquita.](excel_custos_103.PNG)

![Distribuição das alturas dominantes em função da idade para modelo Chapman-Richards anamórfico e seus respectivos limites.](crana.png)

![Distribuição das alturas dominantes em função da idade para modelo Bailey-Clutter polimórfico e seus respectivos limites.](bc_poli.png)

![Distribuição das alturas dominantes em função da idade para modelo Bailey-Clutter anamórfico e seus respectivos limites.](bc_ana.png)

![Distribuição das alturas dominantes em função da idade para modelo Schumacher polimórfico e seus respectivos limites.](sch_poli.png)

![Distribuição das alturas dominantes em função da idade para modelo Schumacher anamórfico e seus respectivos limites.](sch_ana.png)